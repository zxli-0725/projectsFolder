!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("fedopsLogger",[],e):"object"==typeof exports?exports.fedopsLogger=e():t.fedopsLogger=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="https://static.parastorage.com/services/fedops-logger/5.10.0/",n.p="undefined"!=typeof window&&window.__STATICS_BASE_URL__||n.p,n(n.s=18)}([function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i}),n.d(e,"c",function(){return a});var r={},o=function(){return"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof WorkerGlobalScope?WorkerGlobalScope:r};function i(){return"undefined"!=typeof navigator&&navigator&&navigator.sendBeacon}function a(t){return navigator.sendBeacon(t)}}).call(this,n(19))},function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return s}),n.d(e,"d",function(){return u}),n.d(e,"e",function(){return d});var r=n(0);function o(t){return((Object(r.a)().fedops||{}).apps||{})[t]}function i(){Object(r.a)().fedops=Object(r.a)().fedops||{},Object(r.a)().fedops.apps=Object(r.a)().fedops.apps||{}}function a(t){i(),function(t){Object(r.a)().fedops.apps[t]=Object(r.a)().fedops.apps[t]||{}}(t)}function s(t){return(o(t)||{}).startLoadTime||0}function u(t,e){return(o(t)||{}).startLoadTime=e}function d(t){return(Object(r.a)().fedops||{}).sessionId=t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Host="frog.wix.com",e.LoggerVersion="2.0.270",function(t){t.Auto="auto",t.PostMessage="postMessage"}(e.PublishMethods||(e.PublishMethods={})),function(t){t[t.Unsupported=0]="Unsupported"}(e.Errors||(e.Errors={})),function(t){t.msid="_msid",t.clientId="_client_id",t.uuid="_uuid",t.visitorId="_visitorId",t.siteMemberId="_siteMemberId"}(e.EventContextMap||(e.EventContextMap={}))},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var o=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name=n.constructor.name,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,Error),e}();t.exports.defined=function(t,e){if(void 0===t)throw new o(e)},t.exports.object=function(t,e){if(void 0!==t&&("object"!==(void 0===t?"undefined":r(t))||Array.isArray(t)||null===t))throw new o(e)},t.exports.ok=function(t,e){if(!t)throw new o(e)},t.exports.func=function(t,e){if(void 0!==t&&"function"!=typeof t)throw new o(e)},t.exports.AssertionError=o},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e){var n=t.call(this,e)||this;return n.name=n.constructor.name,n}return r(e,t),e}(Error);e.AssertionError=o;var i=function(t){function e(e){var n=t.call(this,e)||this;return n.name=n.constructor.name,n}return r(e,t),e}(Error);e.APINotSupportedError=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.now=function(){return"undefined"!=typeof performance&&performance&&performance.now?performance.now():-1},e.getDesktopSize=function(t){return(t.screen&&t.screen.width||0)+"x"+(t.screen&&t.screen.height||0)},e.getWindowSize=function(t){var e=0,n=0;return t.innerWidth?(e=t.innerWidth,n=t.innerHeight):t.document&&(t.document.documentElement&&t.document.documentElement.clientWidth?(e=t.document.documentElement.clientWidth,n=t.document.documentElement.clientHeight):t.document.body&&t.document.body.clientWidth&&(e=t.document.body.clientWidth,n=t.document.body.clientHeight)),e+"x"+n},e.sendBeacon=function(t,e){return!("undefined"==typeof navigator||!navigator||!navigator.sendBeacon)&&navigator.sendBeacon(t,e)},e.readCookie=function(t){if("undefined"==typeof document)return null;for(var e=0,n=document.cookie.split(";");e<n.length;e++){for(var r=n[e].split("="),o=r[0],i=r[1];" "===o[0];)o=o.substr(1);if(o===t)return i}return""}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2).Host;e.setHost=function(t){r=t},e.getHost=function(){return r},e.isWebWorker=function(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope},e.requestWindow=function(t){if("undefined"!=typeof window&&window)try{return window.top===window.self?t?t(window):window:null}catch(t){return null}return null}},function(t){t.exports={src:72,persistentEndpoint:"performance",nonPersistentEndpoint:"fed",successRateRoot:"fedops_events",performanceRoot:"fedops_performance",appLoadStart:{eventId:14},appLoadFinish:{eventId:11},loadPhaseStart:{eventId:12},loadPhaseFinish:{eventId:13},interactionStart:{eventId:15},interactionEnd:{eventId:16},error:{eventId:17},resource:{eventId:18}}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(3),i=n(22),a=i.mapValues,s=i.filterValues,u=n(23),d=n(24),c=n(25),p=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._publishers=e.publishers,this._validators=e.validators||[],this._defaults=e.defaults,this._events=e.events||{},this._context=n||{},this._defaultValueTimeout=e.defaultValueTimeout||5e3,this._defaultContinueOnFail=e.defaultContinueOnFail||!1,this._onPublisherFailHandler=e.onPublisherFailHandler||t._defaultPublisherFailHandler}return r(t,[{key:"log",value:function(t,e,n){var r=this;o.defined(t,"Event object or event key must be provided.");var i=this._extractEventAndContext(t,e,n),u=i.event,d=i.context,c=void 0!==d.useBatch?d.useBatch:this._context.useBatch;if(c){var p=this._initBuffer(c),f=s(this._defaults,function(t){return"function"==typeof t}),h=a(f,function(t){return t()});return p.feed(Object.assign({},u,h),d)}return this._getDefaults().then(function(t){var e=Object.assign({},t,u);if(!(0===r._validators.length||r._validators.some(function(t){return t.match(e)&&(t.execute(e)||!0)})))throw new Error("No validator accepted the event. Source: "+e.src+" Evid: "+(e.evid||e.evtId));return r._send(e,d)})}},{key:"flush",value:function(){return this._buffer?this._buffer.flush():Promise.resolve()}},{key:"_send",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Promise.all(this._publishers.map(function(r){var o=Object.assign({},t);return Promise.resolve().then(function(){return r(o,Object.assign({},e._context,n))}).catch(function(t){return e._onPublisherFailHandler(t,{publisherName:r.name})})})).then(function(){})}},{key:"_extractEventAndContext",value:function(t,e,n){var r=void 0,i={};if("string"!=typeof t)r=t,i=e||i;else{if(!(r=this._events[t]))throw new o.AssertionError("Event with key '"+t+"' not found in event map.");e&&(r=Object.assign({},r,e),i=n||i)}return{event:r,context:i}}},{key:"_initBuffer",value:function(t){var e=this,n=!0===t?300:t;return this._buffer||(this._buffer=new c(n).onFlush(function(n){var r=s(e._defaults,function(t){return"function"!=typeof t});return n.g=r,e._send(n,{useBatch:t})}))}},{key:"_handleDefaultsError",value:function(t){return this._defaultContinueOnFail?(d.error(t),null):Promise.reject(t)}},{key:"_getDefaults",value:function(){var t=this;if(!this._defaults)return Promise.resolve({});var e=a(this._defaults,function(e,n){if("function"==typeof e)try{e=e()}catch(e){return t._handleDefaultsError(e)}return e&&"function"!=typeof e.then?e:u.timedPromise(e,{message:"Cannot get default value '"+n+" for BI Event'",timeout:t._defaultValueTimeout}).catch(function(e){return t._handleDefaultsError(e)})});return u.allAsObject(e)}}],[{key:"_defaultPublisherFailHandler",value:function(t,e){return e.publisherName}}]),t}();t.exports=p},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(3),i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.reset()}return r(t,[{key:"reset",value:function(){this._handlers=[]}},{key:"onLoggerCreated",value:function(t){o.defined(t,"Handler must be provided."),o.func(t,"Handler must be a function."),this._handlers.push(t)}},{key:"notifyLoggerCreated",value:function(t){this._handlers.forEach(function(e){return e(t)})}}]),t}();t.exports={manager:new i,BiLoggerManager:i}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),o=n(6),i=0;e.getCookies=function(t){return Object.keys(t).reduce(function(e,n){var o="string"==typeof t[n]?{name:t[n]}:t[n],i=o.name,a=o.transform,s=(void 0===a?function(t){return t}:a)(r.readCookie(i));return s&&(e[n]=s),e},{})},e.buildBiUrl=function(t,e,n){var r=t.host,a=void 0===r?"":r,s=t.endpoint,u=void 0===s?"":s;void 0===n&&(n={}),a=a||o.getHost(),u=n.endpoint||u,n.useBatch||(e._=""+(new Date).getTime()+i++);var d=n.useBatch?[]:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])},[]);return["//"+a+"/"+u].concat(d.length?d.join("&"):[]).join("?")},e.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}},function(t){t.exports={src:72,persistentEndpoint:"ds-performance",nonPersistentEndpoint:"ds-performance",successRateRoot:"ds_events",performanceRoot:"ds_performance",appLoadStart:{eventId:31},appLoadFinish:{eventId:33},interactionStart:{eventId:34},interactionEnd:{eventId:35},loadPhaseStart:{eventId:38},loadPhaseFinish:{eventId:32},error:{eventId:36},resource:{eventId:37}}},function(t){t.exports={src:72,persistentEndpoint:"editor-performance",nonPersistentEndpoint:"editor-performance",successRateRoot:"editor_events",performanceRoot:"editor_performance",appLoadStart:{eventId:41},appLoadFinish:{eventId:43},interactionStart:{eventId:44},interactionEnd:{eventId:45},loadPhaseStart:{eventId:48},loadPhaseFinish:{eventId:42},error:{eventId:46},resource:{eventId:47}}},function(t){t.exports={src:72,persistentEndpoint:"bolt-performance",nonPersistentEndpoint:"bolt-performance",successRateRoot:"bolt_events",performanceRoot:"bolt_performance",appLoadStart:{eventId:21},loadPhaseStart:{eventId:28},loadPhaseFinish:{eventId:22},appLoadFinish:{eventId:23},interactionStart:{eventId:24},interactionEnd:{eventId:25},error:{eventId:26},resource:{eventId:27}}},function(t){t.exports={src:72,persistentEndpoint:"ooi-performance",nonPersistentEndpoint:"ooi-performance",successRateRoot:"fedops_events",performanceRoot:"fedops_performance",appLoadStart:{eventId:61},appLoadFinish:{eventId:63},interactionStart:{eventId:64},interactionEnd:{eventId:65},loadPhaseStart:{eventId:68},loadPhaseFinish:{eventId:62},error:{eventId:66},resource:{eventId:67}}},function(t){t.exports={src:72,persistentEndpoint:"mobile-performance",nonPersistentEndpoint:"mobile-performance",successRateRoot:"fedops_events",performanceRoot:"fedops_performance",appLoadStart:{eventId:51},appLoadFinish:{eventId:53},interactionStart:{eventId:54},interactionEnd:{eventId:55},loadPhaseStart:{eventId:58},loadPhaseFinish:{eventId:52},error:{eventId:56},resource:{eventId:57}}},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=n(20),a=o(n(27)),s=n(28),u=n(10),d=n(2),c=n(2);e.PublishMethods=c.PublishMethods;var p=n(6);e.setHost=p.setHost;var f=function(t){return Object.keys(t).reduce(function(e,n){return d.EventContextMap[n]&&(e[d.EventContextMap[n]]=t[n]),e},{})},h=function(){return u.getCookies({clientId:"_wixCIDX",uuid:{name:"_wixUIDX",transform:function(t){return"string"==typeof t&&t.split("|")[1]}}})},l=function(t){return-1!==Object.keys(d.PublishMethods).map(function(t){return d.PublishMethods[t]}).indexOf(t)},m=function(){function t(t){void 0===t&&(t={}),this.options=t,this.initialized=!1,this.muted=!1,a.ok(!t.publishMethod||l(t.publishMethod),'Unsupported publish method "'+t.publishMethod+'"'),this.loggerClientFactory=i.factory(),this.withUserContext(h())}return t.prototype.initFactory=function(){if(this.initialized)return this.loggerClientFactory;this.initialized=!0;var t=s.getPublisher(this.options,this.transformer,this.publishFunctions);return this.loggerClientFactory.addPublisher(t)},t.prototype.withTransformer=function(t){return a.defined(t,"Transformer must be provided"),a.ok("function"==typeof t||t&&"function"==typeof t.postMessage,"Valid transformer must be provided"),this.transformer=t,this},t.prototype.withPublishFunction=function(t){return a.defined(t,"Publish function must be provided"),a.ok(t&&"function"==typeof t.postMessage,"Valid publish function must be provided"),this.publishFunctions=t,this},t.prototype.withUserContext=function(t){return a.defined(t,"User context object must be provided"),this.updateDefaults(f(t)),this},t.prototype.withUoUContext=function(t){return a.defined(t,"UoU context object must be provided"),this.updateDefaults(f(t)),this},t.prototype.updateDefaults=function(t){return this.loggerClientFactory.updateDefaults(t),this},t.prototype.setMuted=function(t){return this.muted=t,this},t.prototype.onError=function(t){return this.loggerClientFactory.setPublisherFailHandler(t),this},t.prototype.logger=function(t){void 0===t&&(t={});var e=this,n=void 0!==t.useBatch?t.useBatch:this.options.useBatch,o=this.initFactory().logger(r({},t,{useBatch:n}));return{log:function(t,n){return e.muted?Promise.resolve():o.log(t,n)}}},t}();e.Factory=m,e.factory=function(t){return void 0===t&&(t={}),new m(t)},e.manager=i.manager},function(t,e,n){var r=n(30),o=n(31);t.exports=function(t,e,n){var i=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;++s)e[i+s]=a[s];return e||o(a)}},function(t,e,n){"use strict";n.r(e);var r=n(7),o=n(11),i=n(12),a=n(13),s=n(14),u=n(15),d={DEFAULT:"DEFAULT",DS:"DS",EDITOR:"EDITOR",OOI:"OOI",BOLT:"BOLT",MOBILE:"MOBILE"};function c(t){switch(t){case d.DEFAULT:return r;case d.BOLT:return a;case d.DS:return o;case d.EDITOR:return i;case d.OOI:return s;case d.MOBILE:return u;default:return r}}var p=n(0),f="0.0.0",h=n(16);var l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.biLoggerFactory,r=e.baseUrl,o=e.endpoint,i=e.preset;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.preset=i,this.factory=n||h.factory({host:r}),this.persistentPublisher=this.factory.logger({endpoint:this.preset.persistentEndpoint}),this.nonPersistentPublisher=this.factory.logger({endpoint:o||this.preset.nonPersistentEndpoint})}return t.prototype.report=function(t,e){if(!t)return null;switch(e){case this.preset.persistentEndpoint:return this.persistentPublisher.log(t);default:return this.nonPersistentPublisher.log(t)}},t}(),m=void 0;function v(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.biLoggerFactory,n=t.baseUrl,r=t.endpoint,o=t.preset;return m?m({preset:o}):new l({biLoggerFactory:e,baseUrl:n,endpoint:r,preset:o})}var g=n(17),y=n.n(g),b={getNavigation:function(){return void 0!==Object(p.a)()&&Object(p.a)().performance?Object(p.a)().performance.navigation:{}},getResources:function(){var t=[];try{return Object(p.a)()&&Object(p.a)().performance&&Object(p.a)().performance.getEntriesByType&&Object(p.a)().performance.getEntriesByType("resource")||t}catch(e){return t}},getTiming:function(){return Object(p.a)()&&Object(p.a)().performance?Object(p.a)().performance.timing:{}},clearResourceTimings:function(){Object(p.a)()&&Object(p.a)().performance&&Object(p.a)().performance.clearResourceTimings&&Object(p.a)().performance.clearResourceTimings()},now:function(){return Object(p.a)()&&Object(p.a)().performance&&Object(p.a)().performance.now?Object(p.a)().performance.now():"undefined"!=typeof performance&&performance&&performance.now?performance.now():(new Date).getTime()},responseEndTime:function(){if("undefined"!=typeof performance&&performance&&performance.timing&&performance.timing.responseEnd&&performance.timing.fetchStart)return performance.timing.responseEnd-performance.timing.fetchStart},mark:function(t){Object(p.a)()&&Object(p.a)().performance&&Object(p.a)().performance.mark&&Object(p.a)().performance.mark(t)},measure:function(t,e,n){Object(p.a)()&&Object(p.a)().performance&&Object(p.a)().performance.measure&&Object(p.a)().performance.measure(t,e,n)}},I=n(1);var _=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.appName=e,this.apps={},this.apps[e]={}}return t.prototype._getKeyForApp=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.appName,e=arguments[1];return e?t+"_"+e:t},t.prototype.setLoadStarted=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.appId,n=t.widgetId,r=this._getKeyForApp(e,n);this.apps[r]||(this.apps[r]={});var o=b.now();this.apps[r].startLoadTime=o,e||Object(I.d)(r,o)},t.prototype.getLoadStartTime=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.appId,n=t.widgetId,r=this._getKeyForApp(e,n),o=this.getLoadStartTimeFromInstance(r)||Object(I.a)(r)||0;return Math.floor(o)},t.prototype.getLoadStartTimeFromInstance=function(t){return this.apps[t]&&this.apps[t].startLoadTime},t.prototype.getAppLoadTime=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.appId,n=t.widgetId;return Math.floor(b.now()-this.getLoadStartTime({appId:e,widgetId:n}))},t.prototype.getFirstRequestDuration=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.appId,n=t.widgetId;return this.getLoadStartTime({appId:e,widgetId:n})},t}();var w=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e}return t.prototype.isActive=function(){return!0},t.prototype.export=function(){return this.data},t}();var P=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.items=[],n&&(void 0===n.length?[n]:n).forEach(function(t){return e.addItem(t)})}return t.prototype.clone=function(){return new t(this.items.slice())},t.prototype.addItem=function(t){return this.items.push(t instanceof w?t:new w(t)),this},t.prototype.mergeItems=function(){for(var t={},e=0;e<this.items.length;e++){var n=this.items[e];if(!n.isActive()){t=null;break}var r=n.export();for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t},t}(),O=function(t){try{return Object(p.a)().localStorage&&Object(p.a)().localStorage.getItem(t)}catch(t){}},S=function(t,e){try{return Object(p.a)().localStorage&&Object(p.a)().localStorage.setItem(t,e)}catch(t){}},x={getSessionId:function(){var t=void 0!==Object(p.a)()&&Object(p.a)().fedops&&Object(p.a)().fedops.sessionId;return t=(t=t||O("fedops.logger.sessionId"))||this.generateGuid(),Object(I.e)(t),S("fedops.logger.sessionId",t),t},generateGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}};var E=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.appName=e,this.phases=new Map,this.indexToKey=new Map,this.times=n||new _(e)}return t._getIndexForPhase=function(t){var e=t.name,n=t.appId,r=void 0===n?"":n,o=t.widgetId;return e+"_"+r+"_"+(void 0===o?"":o)},t.prototype.getAppLoadingPhaseData=function(e){var n=e.name,r=e.appId,o=e.widgetId;return this.phases.get(t._getIndexForPhase({name:n,appId:r,widgetId:o}))},t.prototype.saveLoadingPhase=function(e){var n=e.name,r=e.appId,o=e.widgetId,i=t._getIndexForPhase({name:n,appId:r,widgetId:o});if(!this.phases.has(i)){var a=this.phases.size;this.phases.set(i,{name:n,phaseStartTime:b.now(),index:a}),this.indexToKey.set(a,i)}},t.prototype.endLoadingPhase=function(e){var n=e.name,r=e.appId,o=e.widgetId,i=e.widgetArray,a=t._getIndexForPhase({name:n,appId:r,widgetId:o});if(this.phases.has(a)&&!this.phases.get(a).duration){var s=this.phases.get(a);s.duration=b.now()-s.phaseStartTime,i&&(s.widgetArray=i),o&&(s.widgetId=o),this.phases.set(a,s)}},t.prototype.getNextPhaseToReport=function(){var t=this.phases.size-1,e=this.indexToKey.get(t);return this.phases.get(e)},t.prototype.getPhasePreviousTo=function(e){var n=e.name,r=e.appId,o=e.widgetId,i=this.phases.get(t._getIndexForPhase({name:n,appId:r,widgetId:o})),a=this.indexToKey.get(i.index-1);return this.phases.get(a)},t.prototype.getPhases=function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).appId;return Array.from(this.phases).filter(function(e){var n=e[0].split("_")[1];return t&&n===t||!t}).map(function(t){return function(t){var e;return(e={})[t.name]=t,e}(t[1])})},t.prototype.createCodeParsingPhaseIfNotExist=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.appId,r=e.widgetId,o=t._getIndexForPhase({name:"codeParsingPhase",appId:n,widgetId:r});if(!this.phases.has(o)){var i=this.times.getLoadStartTime({appId:n,widgetId:r});this.phases.set(o,{phaseStartTime:i,index:0,name:"codeParsingPhase"}),this.indexToKey.set(0,o)}},t}();var T=function(t){function e(n){var r=n.appId,o=n.widgetId,i=n.isServerSide,a=n.widgetArray;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return s.data=s._filterUndefined({appId:r,widgetId:o,isServerSide:i,widgetArray:a}),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._filterUndefined=function(t){var e={};return Object.keys(t).forEach(function(n){t[n]&&(e[n]=t[n])}),e},e}(w),j=function(){return void 0!==Object(p.a)()&&Object(p.a)().location},k={getHost:function(){return j()&&Object(p.a)().location.host},isFedopsDev:function(){return((j()||{}).search||"").indexOf("fedops=dev")>-1}};var A={xmlhttprequest:{count:"countXhr",unsupported:"unsprtXhr",duration:"timeXhr",total:"sizeXhr",longest:"longXhr",http2:"h2Xhr"},script:{count:"countJs",unsupported:"unsprtJs",duration:"timeJs",total:"sizeJs",cached:"cachedJs",http2:"h2Js"},link:{count:"countCss",unsupported:"unsprtCss",duration:"timeCss",total:"sizeCss",cached:"cachedCss",http2:"h2Css"},img:{count:"countImg",unsupported:"unsprtImg",duration:"timeImg",total:"sizeImg",cached:"cachedImages",http2:"h2Images"}},L={link:function(t){return/(.\.css$|.\.css?.)/g.test(t.name)}},N=function(t){return t.responseEnd-t.startTime};function F(t,e){var n=L[e];return t.filter(function(t){return e===t.initiatorType&&(!n||n(t))})}function C(t){return!t.name.match(/http(s)?:\/\/frog.wix.com\//)}function D(t){return function(t){var e=k.getHost();return e&&-1===t.indexOf(e)}(t.name)&&0===t.transferSize&&0===t.requestStart}function M(t){var e=t.filter(function(t){return!D(t)});return Object.keys(A).reduce(function(n,r){var o=F(t,r),i=F(e,r),a=A[r];return n[a.count]=i.length,n[a.duration]=function(t){if(0===t.length)return 0;var e={startTime:1/0,responseEnd:0};return t.forEach(function(t){e.startTime>t.startTime&&(e.startTime=t.startTime),e.responseEnd<t.responseEnd&&(e.responseEnd=t.responseEnd)}),e.responseEnd-e.startTime}(i),n[a.total]=function(t){return t.reduce(function(t,e){return t+e.transferSize},0)}(i),n[a.unsupported]=function(t){var e=t.length;if(0===e)return 0;var n=t.filter(D).length;return Math.round(n/e*100)}(o),n[a.http2]=function(t){if(0===t.length)return 0;var e=!1,n=Math.round(t.filter(function(t){return e=e||"nextHopProtocol"in t,"h2"===t.nextHopProtocol}).length/t.length*100);return e?n:NaN}(o),a.longest&&(n[a.longest]=function(t){if(0===t.length)return 0;var e=t.reduce(function(t,e){return N(e)>=N(t)?e:t});return N(e)}(i)),a.cached&&(n[a.cached]=function(t){if(0===t.length)return 0;var e=t.filter(function(t){return 0===t.transferSize});return Math.round(e.length/t.length*100)}(i)),n},{})}function R(t){return{url:t.name,downloadDuration:t.responseEnd-t.startTime,bytesTransferred:t.transferSize,isHTTP2:"h2"===t.nextHopProtocol}}var H=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.performNetworkAnalysis=function(t){if(0===t.length)return null;var e=b.now(),n=t.filter(C),r=M(n);r.overhead=b.now()-e;var o=function(t){return Object.keys(t).reduce(function(e,n){var r=parseInt(t[n]);return isNaN(r)||"number"!=typeof r||(e[n]=r),e},{})}(r);if(console.debug&&k.isFedopsDev()){var i=function(t){var e=t.reduce(function(t,e){return D(e)?t.unsupported.push(e):t.supported.push(e),t},{supported:[],unsupported:[]});return Object.keys(A).reduce(function(t,n){return t[n]={},t[n].supported=F(e.supported,n).map(function(t){return R(t)}),t[n].unsupported=F(e.unsupported,n).map(function(t){return R(t)}),t},{})}(n);console.debug("[fedops network analysis] [bytes analysis]\n"+JSON.stringify(o,null,4)),console.debug("[fedops network analysis] [resources breakdown]\n",i)}return o},e}(w);var B=function(t){function e(n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,{duration:n}))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setFirstRequestDuration=function(t){return this.data.frd=t,this},e}(w);function U(t){delete t[Object.getOwnPropertyNames(t)[0]].index}var V=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._sessionId=e,this._preset=n}return t.prototype.biAppLoadStart=function(){return this._biDataItem(this._preset.appLoadStart.eventId)},t.prototype.biAppLoadFinish=function(){return this._biDataItem(this._preset.appLoadFinish.eventId)},t.prototype.biInteractionStart=function(){return this._biDataItem(this._preset.interactionStart.eventId)},t.prototype.biInteractionEnd=function(){return this._biDataItem(this._preset.interactionEnd.eventId)},t.prototype.biLoadPhaseStart=function(){return this._biDataItem(this._preset.loadPhaseStart.eventId)},t.prototype.biLoadPhaseFinish=function(){return this._biDataItem(this._preset.loadPhaseFinish.eventId)},t.prototype.biError=function(){return this._biDataItem(this._preset.error.eventId)},t.prototype.appName=function(t){var e=t.appName,n=t.isServerSide;return this.dataItem({appName:n?e+"_ssr":e})},t.prototype.artifact=function(t){var e=t.id,n=t.version,r=t.isRollout;return this.dataItem({artifactId:e,artifactVersion:n,isRollout:r})},t.prototype.appContext=function(t){return new T(t)},t.prototype.customParams=function(t){return this.dataItem({customParams:t})},t.prototype.duration=function(t){return new B(t)},t.prototype.loadingPhaseCollection=function(t){var e=JSON.stringify(function(t){var e={},n=t,r=Array.isArray(n),o=0;for(n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if((o=n.next()).done)break;i=o.value}var a=i;U(a),e=Object.assign(e,a)}return e}(t));return this.dataItem({phases:e})},t.prototype.loadingPhaseStart=function(t){var e=t.name;return this.dataItem({name:e})},t.prototype.loadingPhaseFinish=function(t){var e=t.name,n=function(t){return Math.floor(b.now()-t)}(t.phaseStartTime);return this.dataItem({name:e,duration:n})},t.prototype.loadingPhaseFinishPrefixed=function(t){var e=t.name,n=t.index,r=t.phaseStartTime,o=function(t,e){return("0"+e).slice(-2)+"_"+t}(e,n);return this.loadingPhaseFinish({name:o,phaseStartTime:r})},t.prototype.resource=function(){var t=this._asBiEvent(this._preset.resource.eventId);return new H(t)},t.prototype.dataItem=function(t){return new w(t)},t.prototype._biDataItem=function(t){var e=this._asBiEvent(t);return this.dataItem(e)},t.prototype._asBiEvent=function(t){return{src:this._preset.src,evid:t,session_id:this._sessionId,_:(new Date).getTime()}},t}(),W={SEND_ON_START:"SEND_ON_START",SEND_ON_FINISH:"SEND_ON_FINISH",SEND_ON_APP_LOADED:"SEND_ON_APP_LOADED",SEND_START_AND_FINISH:"SEND_START_AND_FINISH"},z=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var J=function(t,e){if(t)return t(e)},G=function(){function t(e,n,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i={appId:null,widgetId:null,metasiteId:null,sessionId:x.getSessionId(),isServerSide:null,disableAutoLoadFinish:!1,phasesConfig:W.SEND_ON_START,interactionTimeout:null,timeoutHook:null,startHook:null,endHook:null,isPersistent:!1,corrId:y()(),presetType:d.DEFAULT,customParams:{},paramsOverrides:{}},a=Object.assign({},i,o);this.appName=e,this.appVersion=n,this.appId=a.appId,this.widgetId=a.widgetId,this.metasiteId=a.metasiteId,this.corrId=a.corrId,this.isServerSide=a.isServerSide,this.params={sessionId:a.sessionId},this._customParams=Object.assign({},a.customParams),this.disableAutoLoadFinish=a.disableAutoLoadFinish,this.phasesConfig=a.phasesConfig,this._appLoadedCalled={},this._appStartLoadCalled={},this._presetType=a.presetType,this._preset=c(this._presetType),this.dataItems=new V(this.sessionId,this._preset),this.reporter=r||v({preset:this._preset}),this.times=new _(e),this.loadingPhases=new E(e,this.times),this.dataSourceBase=new P,this.dataSourceBase.addItem(this.dataItems.appName({appName:e,isServerSide:this.isServerSide})).addItem(this.dataItems.dataItem({corrId:this.corrId})).addItem(this.dataItems.dataItem(a.paramsOverrides)),o&&o.artifactData&&this.dataSourceBase.addItem(this.dataItems.artifact(o.artifactData)),this._outgoingInteractions={},this.interactionTimeout=a.interactionTimeout,this.timeoutHook=a.timeoutHook,this.startHook=a.startHook,this.endHook=a.endHook,this.isPersistent=a.isPersistent}return t.prototype._report=function(t,e){return this.reporter.report(t.mergeItems(),e)},t.prototype.getAppName=function(){return this.appName},t.prototype.getAppVersion=function(){return this.appVersion},t.prototype.getReporter=function(){return this.reporter},t.prototype.getParam=function(t){return this.params[t]},t.prototype._isDisableAutoLoadFinish=function(){return this.disableAutoLoadFinish},t.prototype.isDisableAutoLoadFinish=function(){return this._isDisableAutoLoadFinish()},t.prototype.reportNetworkAnalysis=function(t){var e=this,n=t.appId,r=b.getResources();setTimeout(function(){try{var t=e.dataItems.resource(),o=t.performNetworkAnalysis(r);if(!o)return;var i=e.dataSource.addItem(t).addItem(o);n&&e._changeAppNameForEvent(i,n),e._report(i)}catch(t){console.error("[fedops] Failed to report resource metrics",t)}},1e3)},t.prototype.appLoadStarted=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.appId,r=e.paramsOverrides;if(!(n&&this._appStartLoadCalled[n]||!n&&this._appStartLoadCalled[this.appName])){t._markAppLoadStarted(this.appName),this._appStartLoadCalled[n||this.appName]=!0,this.times.setLoadStarted({appId:n});var o=this.dataSource.addItem(this.dataItems.biAppLoadStart()).addItem(this.dataItems.appContext({appId:n||this.appId,widgetId:this.widgetId,isServerSide:this.isServerSide})).addItem(this.dataItems.dataItem(r));return n&&this._changeAppNameForEvent(o,n),this._report(o,this._getEndpoint())}},t.prototype._isCustomParamsAllowed=function(){return this._presetType===d.DEFAULT},t.prototype._isOverridingTimeAllowed=function(){return this._presetType===d.MOBILE},t.prototype.appLoaded=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.appId,r=e.customParams,o=e.paramsOverrides;if(!(n&&this._appLoadedCalled[n]||!n&&this._appLoadedCalled[this.appName])){t._clearLoadTimeout(),t._markAndMeasureAppLoad(this.appName),this._appLoadedCalled[n||this.appName]=!0,this._sendLastAppLoadPhaseIfNeeded(),this.reportNetworkAnalysis({appId:n});var i=this.dataSource.addItem(this.dataItems.biAppLoadFinish()).addItem(this.dataItems.appContext({appId:n||this.appId,widgetId:this.widgetId,isServerSide:this.isServerSide})).addItem(this.dataItems.duration(this.times.getAppLoadTime({appId:n})).setFirstRequestDuration(this.times.getFirstRequestDuration())).addItem(this.dataItems.dataItem(o));if(n&&this._changeAppNameForEvent(i,n),this._isCustomParamsAllowed()){var a="string"==typeof r?JSON.parse(r):r;if(r=Object.assign({},this._customParams,a),Object.keys(r).length>0){var s=JSON.stringify(r);i.addItem(this.dataItems.customParams(s))}}if(this.phasesConfig===W.SEND_ON_APP_LOADED){var u=this.loadingPhases.getPhases({appId:n});u.length>0&&i.addItem(this.dataItems.loadingPhaseCollection(u))}return this._report(i,this._getEndpoint())}},t.prototype.appLoadingPhaseStart=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.appId,r=e.widgetId,o=e.paramsOverrides;if(this.phasesConfig===W.SEND_ON_START&&this.loadingPhases.createCodeParsingPhaseIfNotExist({appId:n,widgetId:r}),this.loadingPhases.saveLoadingPhase({name:t,appId:n,widgetId:r}),this._sendPreviousPhaseIfNeeded(t,{appId:n,widgetId:r,paramsOverrides:o}),b.mark("[fedops] "+t+" started"),this.phasesConfig===W.SEND_START_AND_FINISH){var i=this.dataSource.addItem(this.dataItems.biLoadPhaseStart()).addItem(this.dataItems.appContext({appId:n,widgetId:r})).addItem(this.dataItems.loadingPhaseStart({name:t})).addItem(this.dataItems.dataItem(o));n&&this._changeAppNameForEvent(i,n),this._report(i,this._getEndpoint())}},t.prototype._changeAppNameForEvent=function(t,e){t.addItem(this.dataItems.appName({appName:e,isServerSide:this.isServerSide}))},t.prototype._sendPreviousPhaseIfNeeded=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.appId,r=e.widgetId,o=e.paramsOverrides;if(this.phasesConfig===W.SEND_ON_START){var i=this.loadingPhases.getPhasePreviousTo({name:t,appId:n,widgetId:r});b.mark("[fedops] "+i.name+" finished");var a=this.dataItems.loadingPhaseFinishPrefixed(i),s=this.dataItems.biLoadPhaseFinish(),u=this.dataItems.dataItem(o),d=this.dataSource.addItem(a).addItem(s).addItem(u);this._report(d)}},t.prototype.appLoadingPhaseFinish=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.appId,r=e.widgetId,o=e.widgetArray,i=e.paramsOverrides;if(this.phasesConfig===W.SEND_ON_START)throw new Error('To use appLoadingPhaseFinish you must create the logger with the "phasesConfig: SEND_ON_FINISH, SEND_ON_APP_LOADED or SEND_START_AND_FINISH" param');if(b.mark("[fedops] "+t+" finished"),this.phasesConfig!==W.SEND_ON_APP_LOADED){var a=this.loadingPhases.getAppLoadingPhaseData({name:t,appId:n,widgetId:r});if(!a)throw new Error("Cannot report end of a phase that wasn't started. Phase "+t+" doesn't exist");var s=this.dataItems.loadingPhaseFinish(a),u=this.dataItems.biLoadPhaseFinish(),d=this.dataItems.dataItem(i),c=this.dataItems.appContext({appId:n,widgetId:r,widgetArray:o,isServerSide:this.isServerSide}),p=this.dataSource.addItem(s).addItem(u).addItem(c).addItem(d);return n&&this._changeAppNameForEvent(p,n),this._report(p,this._getEndpoint())}this.loadingPhases.endLoadingPhase({name:t,appId:n,widgetId:r,widgetArray:o})},t.prototype._getEndpoint=function(){return this.isPersistent?this._preset.persistentEndpoint:this._preset.nonPersistentEndpoint},t.prototype._sendLastAppLoadPhaseIfNeeded=function(){var t=this.loadingPhases.getNextPhaseToReport();this.phasesConfig===W.SEND_ON_START&&t&&"codeParsingPhase"!==t.name&&this._report(this.dataSource.addItem(this.dataItems.loadingPhaseFinishPrefixed(t)).addItem(this.dataItems.biLoadPhaseFinish()))},t._clearLoadTimeout=function(){Object(p.a)()&&Object(p.a)().fedops&&"function"==typeof Object(p.a)().fedops.clearLoadTimeout&&Object(p.a)().fedops.clearLoadTimeout()},t.prototype.clearResourceTimings=function(){b.clearResourceTimings()},t._markAppLoadStarted=function(t){b.mark("[fedops] "+t+" app-load-started")},t._markAndMeasureAppLoad=function(t){b.mark("[fedops] "+t+" app-loaded");try{b.measure("[fedops] "+t+" app-loaded","[fedops] "+t+" app-load-started","[fedops] "+t+" app-loaded")}catch(t){}},t._markInteractionStarted=function(t){b.mark("[fedops] "+t+" started")},t._markAndMeasureInteractionEnded=function(t,e){if(e){b.mark("[fedops] "+t+" ended");try{b.measure("[fedops] "+t+" duration","[fedops] "+t+" started","[fedops] "+t+" ended")}catch(t){}}},t.prototype.interactionStarted=function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.timeOverride,i=r.interactionTimeout,a=r.startHook,s=r.timeoutHook;if(o&&!this._isOverridingTimeAllowed())throw new Error("Overriding time parameter of interaction is not permitted");t._markInteractionStarted(e);var u=this.dataSource.addItem({name:e}).addItem(this.dataItems.biInteractionStart());return this._outgoingInteractions[e]={timestamp:o||b.now(),timeout:i||this.interactionTimeout},this._report(u),J(a||this.startHook,{name:e}),{timeoutId:function(){if(i||n.interactionTimeout)return setTimeout(function(){var t=n.dataSource.addItem({interactionName:e}).addItem({errorType:"timeout"}).addItem(n.dataItems.biError());n._report(t),J(s||n.timeoutHook,{name:e,timeout:i||n.interactionTimeout})},i||n.interactionTimeout)}()}},t.prototype.interactionEnded=function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.timeOverride,i=r.timeoutId,a=r.endHook;if(o&&!this._isOverridingTimeAllowed())throw new Error("Overriding time parameter of interaction is not permitted");var s=this._outgoingInteractions[e];t._markAndMeasureInteractionEnded(e,s),i&&clearTimeout(i);var u=this._outgoingInteractions[e]||function(t){return t.fedops&&t.fedops.apps&&t.fedops.apps[n.appName]&&t.fedops.apps[n.appName].interactions&&t.fedops.apps[n.appName].interactions[e]}(Object(p.a)()),d=o||b.now(),c=u?Math.floor(d-u.timestamp):"";J(a||this.endHook,{name:e,duration:c,timeout:this._outgoingInteractions[e]&&this._outgoingInteractions[e].timeout});var f=this.dataSource.addItem({name:e}).addItem({duration:c}).addItem(this.dataItems.biInteractionEnd());delete this._outgoingInteractions[e],this._report(f)},t.prototype.getLoggerForWidget=function(e){var n=e.appName,r=e.appId,o=e.widgetId,i=e.version,a=e.timeoutHook,s=e.startHook,u=e.endHook,d=e.useGlobalLogger,c=e.paramsOverrides,p=e.phasesConfig;return new t(n||r+"_"+o,i||this.getAppVersion(),d?this.reporter:v({biLoggerFactory:this.reporter.factory,preset:this._preset}),{isServerSide:this.isServerSide,appId:r,widgetId:o,sessionId:this.sessionId,phasesConfig:p||W.SEND_ON_START,isPersistent:this.isPersistent,timeoutHook:a,startHook:s,endHook:u,customParams:this._customParams,presetType:this._presetType,paramsOverrides:c})},z(t,[{key:"dataSource",get:function(){return this.dataSourceBase.clone()}},{key:"sessionId",get:function(){return this.getParam("sessionId")},set:function(t){this.params.sessionId=t}}]),t}();n.d(e,"create",function(){return q}),n.d(e,"reportAppLoadStarted",function(){return K}),n.d(e,"phasesConfig",function(){return $});var X=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return null;var n=t.replace(/\./g,"-");Object(I.c)(n);var r=X({},e,{preset:c(e.presetType)}),o=v(r);return new G(n,Object(p.a)().__CI_APP_VERSION__||f,o,r)}function K(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.artifactData,r=e.presetType,o=e.isPersistent;Object(I.c)(t),Object(I.d)(t,b.responseEndTime()||b.now());var i=x.getSessionId();Object(I.e)(i);var a=c(r),s="//frog.wix.com/"+(!0===o?a.persistentEndpoint:a.nonPersistentEndpoint)+"?appName="+t+"&src="+a.src+"&evid="+a.appLoadStart.eventId+"&session_id="+i+"&_="+Math.random();n&&(s+="&artifactId="+n.id+"&artifactVersion="+n.version+"&isRollout="+n.isRollout),Object(p.b)()?Object(p.c)(s):(new Image).src=s}var $=W},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";var r=n(21),o=n(8),i=n(9);t.exports.BiLoggerFactory=r,t.exports.BiLogger=o,t.exports.BiLoggerManager=i.BiLoggerManager,t.exports.factory=function(){return new r},t.exports.manager=i.manager},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=n(3),a=n(8),s=n(9),u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._publishers=[],this._validators=[],this._defaults={},this._events={}}return o(t,[{key:"addPublisher",value:function(t){return i.defined(t,"Publisher must be provided"),i.ok("function"==typeof t,"Expected a publisher function"),this._publishers.push(t),this}},{key:"addValidator",value:function(t){return i.defined(t,"Validator must be provided"),i.ok("object"===(void 0===t?"undefined":r(t))&&t,"Expected a validator object"),i.ok(t.execute&&t.match,"Provided validator does not match the interface"),this._validators.push(t),this}},{key:"setDefaults",value:function(t){return i.defined(t,"Defaults must be provided"),i.object(t,"Defaults must be an object"),this._defaults=t,this}},{key:"updateDefaults",value:function(t){return i.defined(t,"Defaults must be provided"),i.object(t,"Defaults must be an object"),Object.assign(this._defaults,t),this}},{key:"setEvents",value:function(t){return i.defined(t,"Events must be provided"),i.object(t,"Events must be an object"),this._events=t,this}},{key:"setDefaultValueTimeout",value:function(t){return i.defined(t,"Default Value Timeout must be provided"),this._defaultValueTimeout=t,this}},{key:"setDefaultContinueOnFail",value:function(t){return i.defined(t,"Default Continue On Fail must be provided"),this._defaultContinueOnFail=t,this}},{key:"setPublisherFailHandler",value:function(t){return i.defined(t,"Publisher Fail Handler must be provided"),this._onPublisherFailHandler=t,this}},{key:"logger",value:function(t){var e=new a({publishers:this._publishers,validators:this._validators,defaults:this._defaults,events:this._events,defaultValueTimeout:this._defaultValueTimeout,defaultContinueOnFail:this._defaultContinueOnFail,onPublisherFailHandler:this._onPublisherFailHandler},t);return s.manager.notifyLoggerCreated(e),e}}]),t}();t.exports=u},function(t,e,n){"use strict";t.exports.mapValues=function(t,e){return t?Object.keys(t).reduce(function(n,r){return n[r]=e(t[r],r,t),n},{}):{}},t.exports.filterValues=function(t,e){return t?Object.keys(t).reduce(function(n,r){return e(t[r],r,t)&&(n[r]=t[r]),n},{}):{}}},function(t,e,n){"use strict";t.exports.timedPromise=function(t,e){var n=e.message,r=e.timeout,o=new Promise(function(t,e){setTimeout(e,r,n?"Timeout: "+n:"Timeout")});return Promise.race([t,o])},t.exports.allAsObject=function(t){var e=Object.keys(t);return Promise.all(e.map(function(e){return t[e]})).then(function(t){return t.reduce(function(t,n,r){return t[e[r]]=n,t},{})})}},function(t,e,n){"use strict";t.exports={error:function(){var t;console&&console.error&&(t=console).error.apply(t,arguments)}}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(26),i=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._flushHandler=function(t){return t},this._flushDebounced=o(function(){return n.flush()},e),this._init()}return r(t,[{key:"_init",value:function(){var t=this;this._startTime=Date.now(),this._events=[],this._resolve=null,this._promise=new Promise(function(e){return t._resolve=e})}},{key:"flush",value:function(){if(!this._events.length)return Promise.resolve();var t=this._events,e=this._resolve,n=this._startTime;return this._init(),this._flushHandler(function(t,e){return{dt:Date.now()-e,e:t}}(t,n)).then(e)}},{key:"onFlush",value:function(t){return this._flushHandler=t,this}},{key:"feed",value:function(t,e){return this._events.push(function(t,e,n){return{dt:Date.now()-n,f:t,context:e}}(t,e,this._startTime)),this._flushDebounced(),this._promise}}]),t}();t.exports=i},function(t,e,n){"use strict";t.exports=function(t,e,n){var r=void 0;return function(){var o=this,i=arguments,a=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||t.apply(o,i)},e),a&&t.apply(o,i)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4);e.defined=function(t,e){if(void 0===t)throw new r.AssertionError(e)},e.object=function(t,e){if(void 0!==t&&("object"!=typeof t||Array.isArray(t)||null===t))throw new r.AssertionError(e)},e.ok=function(t,e){if(!t)throw new r.AssertionError(e)}},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&(n[r[o]]=t[r[o]])}return n};Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),a=n(6),s=n(2),u=n(4),d=n(5),c=n(29),p=function(t){return t.useBatch?"POST":"GET"},f=function(t){return void 0===t&&(t={}),t.ms=Math.round(d.now()),t._lv=s.LoggerVersion,t},h=function(t,e){e&&("function"!=typeof e&&e.postMessage&&t.publishMethod===s.PublishMethods.PostMessage?e=e.postMessage:"function"!=typeof e&&(e=null));var n=e?function(t){return e(f(t))}:f;return function(e,i){return i.useBatch?(e.e=e.e.map(function(e){var a=e.context,s=o(e,["context"]);return r({},s,{f:r({},n(s.f),{_rp:a&&a.endpoint||i.endpoint||t.endpoint})})}),e):n(e)}};function l(t){return void 0===t&&(t={}),function(e,n){void 0===n&&(n={});var r=i.buildBiUrl(t,e,n);return c.beaconTransport(r,e,!!n.useBatch).catch(function(){return n.useBatch?c.fetchTransport(r,e,p(n)):c.pixelTransport(r,n.image)})}}function m(t){return void 0===t&&(t={}),function(e,n){void 0===n&&(n={});var r=i.buildBiUrl(t,e,n),o=p(n);return c.fetchTransport(r,e,o).catch(function(t){return t instanceof u.APINotSupportedError?c.xhrTransport(r,e,o):Promise.reject(t)})}}function v(t,e){return void 0===t&&(t={}),function(t){return c.postMessageTransport(t,e)}}e.imagePublisher=function(t){return void 0===t&&(t={}),function(e,n){if(void 0===n&&(n={}),n.useBatch)throw new u.APINotSupportedError("Can't use image publisher to send batched events.");var r=i.buildBiUrl(t,e,n);return c.pixelTransport(r,n.image)}},e.beaconPublisher=l,e.fetchPublisher=m,e.xhrPublisher=function(t){return void 0===t&&(t={}),function(e,n){void 0===n&&(n={});var r=i.buildBiUrl(t,e,n),o=p(n);return c.xhrTransport(r,e,o)}},e.postMessagePublisher=v,e.resolvePublisher=function(t,e){var n,r;return t.publishMethod===s.PublishMethods.PostMessage?(n=v,r=e&&e.postMessage):n=a.isWebWorker()?m:l,n(t,r)},e.getPublisher=function(t,n,r){var o=e.resolvePublisher(t,r),i=h(t,n);return function(t,e){return o(i(t,e),e)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),o=n(4);e.beaconTransport=function(t,e,n){return void 0===n&&(n=!1),new Promise(function(o,i){return r.sendBeacon(t,n?JSON.stringify(e):void 0)?o():i(new Error("Transport Error: Cannot send bi using beacon"))})},e.pixelTransport=function(t,e){return new Promise(function(n,r){var o=e||new window.Image(0,0);o.onload=function(){return n()},o.onerror=function(){return r(new Error("Transport Error: Cannot send bi using pixel"))},o.src=t})},e.fetchTransport=function(t,e,n){if(void 0===n&&(n="GET"),"undefined"==typeof fetch)return Promise.reject(new o.APINotSupportedError("fetch"));var r={method:n,credentials:"include"};return"POST"===n?r.body=JSON.stringify(e):r.keepalive=!0,fetch(t,r).then(function(t){if(!t.ok)throw Error("Transport Error: Cannot send bi using fetch. Status: "+t.status)})},e.xhrTransport=function(t,e,n){return void 0===n&&(n="GET"),new Promise(function(r,o){var i=new XMLHttpRequest;i.open(n,""+location.protocol+t),i.onload=r,i.onerror=function(){o(new Error("Transport Error: Cannot send bi using xhr."))},i.withCredentials=!0,"POST"===n?i.send(JSON.stringify(e)):i.send()})},e.postMessageTransport=function(t,e){void 0===e&&(e=self.postMessage);var n=[t];return"undefined"==typeof WorkerGlobalScope&&n.push("*"),e.apply(self,n)}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var o=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),o[e]=t>>>((3&e)<<3)&255;return o}}},function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0,o=n;return[o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]]].join("")}}])});
//# sourceMappingURL=fedops-logger.bundle.min.js.map